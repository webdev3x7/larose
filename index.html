<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Secure P2P Chat</title>
</head>
<body>
    <h2>ðŸ”’ Secure P2P Chat (WebRTC)</h2>
    
    <textarea id="messages" rows="10" cols="50" readonly></textarea><br>
    
    <input type="text" id="message" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>

    <h3>Connection Setup</h3>
    <textarea id="offer" placeholder="Paste offer here"></textarea>
    <button onclick="createOffer()">Create Offer</button>
    
    <textarea id="answer" placeholder="Paste answer here"></textarea>
    <button onclick="createAnswer()">Create Answer</button>
    
    <button onclick="addAnswer()">Add Answer</button>

    <script>
        let localConnection = new RTCPeerConnection({
            iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
        });
        let dataChannel;

        localConnection.onicecandidate = e => {
            if (e.candidate) return;
            document.getElementById('offer').value = JSON.stringify(localConnection.localDescription);
        };

        localConnection.ondatachannel = e => {
            dataChannel = e.channel;
            setupDataChannel();
        };

        function createOffer() {
            dataChannel = localConnection.createDataChannel("chat");
            setupDataChannel();
            localConnection.createOffer()
                .then(offer => localConnection.setLocalDescription(offer))
                .then(() => document.getElementById('offer').value = JSON.stringify(localConnection.localDescription));
        }

        function createAnswer() {
            let remoteOffer = JSON.parse(document.getElementById('offer').value);
            localConnection.setRemoteDescription(new RTCSessionDescription(remoteOffer))
                .then(() => localConnection.createAnswer())
                .then(answer => localConnection.setLocalDescription(answer))
                .then(() => document.getElementById('answer').value = JSON.stringify(localConnection.localDescription));
        }

        function addAnswer() {
            let remoteAnswer = JSON.parse(document.getElementById('answer').value);
            localConnection.setRemoteDescription(new RTCSessionDescription(remoteAnswer));
        }

        function setupDataChannel() {
            dataChannel.onmessage = e => {
                document.getElementById('messages').value += "Friend: " + e.data + "\n";
            };
            dataChannel.onopen = () => console.log("Connection opened!");
        }

        function sendMessage() {
            let message = document.getElementById('message').value;
            dataChannel.send(message);
            document.getElementById('messages').value += "You: " + message + "\n";
            document.getElementById('message').value = "";
        }
    </script>
</body>
</html>
